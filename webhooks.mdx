---
title: Webhooks
description: Receive real-time notifications about payment status changes
---

# Webhooks

Webhooks allow you to receive real-time notifications when events occur in your PrimePix account, such as when a payment is completed or fails.

## How webhooks work

When an event occurs, PrimePix sends an HTTP POST request to your webhook URL with details about the event. Your server should respond with a `200 OK` status to acknowledge receipt.

## Setting up webhooks

1. Log in to your PrimePix dashboard
2. Navigate to Settings > Webhooks
3. Enter your webhook URL
4. Select the events you want to receive
5. Save your configuration

## Webhook events

### payment.completed

Triggered when a PIX payment is successfully completed.

```json
{
  "event": "payment.completed",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "transactionId": 12345,
    "externalId": "order_123",
    "amount": 100.00,
    "fee": 2.50,
    "netAmount": 97.50,
    "status": "completed",
    "paidAt": "2024-01-15T10:29:45Z",
    "customer": {
      "name": "JoÃ£o Silva",
      "document": "12345678900",
      "email": "joao@example.com"
    }
  }
}
```

### payment.failed

Triggered when a PIX payment fails or expires.

```json
{
  "event": "payment.failed",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "transactionId": 12345,
    "externalId": "order_123",
    "amount": 100.00,
    "status": "failed",
    "reason": "expired"
  }
}
```

### withdrawal.completed

Triggered when a withdrawal is successfully processed.

```json
{
  "event": "withdrawal.completed",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "withdrawalId": 67890,
    "amount": 500.00,
    "pixKey": "joao@example.com",
    "pixKeyType": "EMAIL",
    "status": "completed",
    "completedAt": "2024-01-15T10:29:45Z"
  }
}
```

### withdrawal.failed

Triggered when a withdrawal fails.

```json
{
  "event": "withdrawal.failed",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "withdrawalId": 67890,
    "amount": 500.00,
    "status": "failed",
    "reason": "insufficient_balance"
  }
}
```

## Handling webhooks

### Example implementation

```javascript Node.js
const express = require('express');
const app = express();

app.post('/webhooks/primepix', express.json(), (req, res) => {
  const { event, data } = req.body;

  switch (event) {
    case 'payment.completed':
      console.log(`Payment ${data.transactionId} completed`);
      // Update your database, send confirmation email, etc.
      break;

    case 'payment.failed':
      console.log(`Payment ${data.transactionId} failed`);
      // Handle failed payment
      break;

    case 'withdrawal.completed':
      console.log(`Withdrawal ${data.withdrawalId} completed`);
      // Update withdrawal status
      break;

    case 'withdrawal.failed':
      console.log(`Withdrawal ${data.withdrawalId} failed`);
      // Handle failed withdrawal
      break;
  }

  // Always respond with 200 OK
  res.status(200).send('OK');
});

app.listen(3000);
```

```python Python
from flask import Flask, request

app = Flask(__name__)

@app.route('/webhooks/primepix', methods=['POST'])
def webhook():
    data = request.json
    event = data.get('event')
    event_data = data.get('data')

    if event == 'payment.completed':
        print(f"Payment {event_data['transactionId']} completed")
        # Update your database, send confirmation email, etc.

    elif event == 'payment.failed':
        print(f"Payment {event_data['transactionId']} failed")
        # Handle failed payment

    elif event == 'withdrawal.completed':
        print(f"Withdrawal {event_data['withdrawalId']} completed")
        # Update withdrawal status

    elif event == 'withdrawal.failed':
        print(f"Withdrawal {event_data['withdrawalId']} failed")
        # Handle failed withdrawal

    # Always respond with 200 OK
    return 'OK', 200

if __name__ == '__main__':
    app.run(port=3000)
```

```php PHP
<?php
// webhook.php

$payload = file_get_contents('php://input');
$data = json_decode($payload, true);

$event = $data['event'];
$eventData = $data['data'];

switch ($event) {
    case 'payment.completed':
        error_log("Payment {$eventData['transactionId']} completed");
        // Update your database, send confirmation email, etc.
        break;

    case 'payment.failed':
        error_log("Payment {$eventData['transactionId']} failed");
        // Handle failed payment
        break;

    case 'withdrawal.completed':
        error_log("Withdrawal {$eventData['withdrawalId']} completed");
        // Update withdrawal status
        break;

    case 'withdrawal.failed':
        error_log("Withdrawal {$eventData['withdrawalId']} failed");
        // Handle failed withdrawal
        break;
}

// Always respond with 200 OK
http_response_code(200);
echo 'OK';
?>
```

## Security best practices

<AccordionGroup>
  <Accordion title="Verify webhook signatures">
    Always verify that webhook requests are coming from PrimePix by checking the signature header (if provided).
  </Accordion>

  <Accordion title="Use HTTPS">
    Your webhook URL must use HTTPS to ensure data is encrypted in transit.
  </Accordion>

  <Accordion title="Validate event data">
    Always validate the event data before processing it. Don't trust the webhook data blindly.
  </Accordion>

  <Accordion title="Implement idempotency">
    Webhooks may be sent multiple times. Use the transaction ID to prevent duplicate processing.
  </Accordion>

  <Accordion title="Respond quickly">
    Process webhooks asynchronously and respond with 200 OK immediately. Don't perform long-running operations in the webhook handler.
  </Accordion>
</AccordionGroup>

## Testing webhooks

You can test your webhook integration using tools like:

- **ngrok**: Create a public URL for your local server
- **webhook.site**: Inspect webhook payloads
- **Postman**: Send test webhook requests manually

### Example test payload

```bash
curl -X POST https://your-domain.com/webhooks/primepix \
  -H "Content-Type: application/json" \
  -d '{
    "event": "payment.completed",
    "timestamp": "2024-01-15T10:30:00Z",
    "data": {
      "transactionId": 12345,
      "externalId": "order_123",
      "amount": 100.00,
      "status": "completed"
    }
  }'
```

## Troubleshooting

### Webhook not received

- Check that your webhook URL is correct and accessible from the internet
- Verify your server is responding with `200 OK`
- Check your firewall settings

### Duplicate webhooks

- Implement idempotency using transaction IDs
- Store processed webhook IDs to prevent duplicate processing

### Webhook timeouts

- Respond with `200 OK` immediately
- Process webhook data asynchronously in a background job
